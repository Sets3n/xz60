[TOC]

# 矩阵的排布

## 键盘的触发原理

引言[^1]

> 在键盘中按键数量较多时，为了减少I/O口的占用，通常将按键排列成矩阵形式。在矩阵式键盘中，每条水平线和垂直线在交叉处不直接连通，而是通过一个按键加以连接。这样，一个端口（如P1口）就可以构成4*4=16个按键，比之直接将端口线用于键盘多出了一倍，而且线数越多，区别越明显，比如再多加一条线就可以构成20键的键盘，而直接用端口线则只能多出一键（9键）。由此可见，在需要的键数比较多时，采用矩阵法来做键盘是合理的。

[^1]: 以上摘自百度百科

## 实操

1. 将配列图里的配列代码全选后复制，我这里增加了分裂空格的支持。将多配列支持的按键分开在，这样在分配矩阵的时候会更直观

   ![image-20210818145953939](C:\Users\Sets3n\Downloads\pcb教程\半吊子画pcb教程---第二章矩阵的排布.assets\image-20210818145953939.png)

2. 打开网站：https://kbfirmware.com/ 将复制的代码填入点击import

   ![image-20210818114256696](C:\Users\Sets3n\Downloads\pcb教程\半吊子画pcb教程---第二章矩阵的确定.assets\image-20210818114256696.png)

3. 可以看到自动生成的一个5x15的矩阵图并且有很多错误，接下来我们要对矩阵图进行修改

4. 修改的时候尽量减少矩阵的占用。这样布线方便引脚用的也少，为了实现更多功能。采用最小资源占用原则。

   ![image-20210818145929586](C:\Users\Sets3n\Downloads\pcb教程\半吊子画pcb教程---第二章矩阵的排布.assets\image-20210818145929586.png)

   ![image-20210818180156156](C:\Users\Sets3n\Downloads\pcb教程\半吊子画pcb教程---第二章矩阵的排布.assets\image-20210818180156156.png)

5. 分配好矩阵以后我们来分配引脚

   ![image-20210818150110193](C:\Users\Sets3n\Downloads\pcb教程\半吊子画pcb教程---第二章矩阵的排布.assets\image-20210818150110193.png)

6. 分配引脚的时候避免不了要看32u4的文档和图才可以对引脚进行掌握参考文档https://www.docin.com/p-776342584.html

   还需要考虑主控贴上后，布线的方便程度。

   ![image-20210818150435145](C:\Users\Sets3n\Downloads\pcb教程\半吊子画pcb教程---第二章矩阵的排布.assets\image-20210818150435145.png)

7. 我们给capslock增加一个引脚用于大写指示灯，（因为兼容多佩列，RGB灯无法兼容多佩列，只能放弃RGB了），下面就是我分配好的矩阵图引脚，目的是为了将主控正向放置在空格附近。

   ![image-20210819162812581](C:\Users\Sets3n\Downloads\pcb教程\半吊子画pcb教程---第二章矩阵的排布.assets\image-20210819162812581.png)

8. 我们的矩阵和主控引脚的分配到这里就结束了。下面一章开始根据这章的内容绘制pcb的原理图。

