[TOC]

# 第三章 绘制原理图

我们通过上面两章的学习已经分配好了主控的引脚和矩阵图。下面我们可以绘制原理图了

## 下载立创EDA

1. 百度立创EDA并下载EDA进行安装

   ![image-20210818182140335](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818182140335.png)

   ![image-20210818182210922](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818182210922.png)

2. 安装完成后打开EDA

   ![image-20210818182259605](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818182259605.png)

## 基本操作

1. 创建原理图

   ![image-20210818182335133](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818182335133.png)

2. 打开一个空白的原理图模板，我们添加元件

   1. 点击元件库
   2. 输入atmega32u4搜索
   3. 点击找到的元件
   4. 将元件符号放入原理图

   ![image-20210818182537071](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818182537071.png)

3. 鼠标选中序号可以拖动，右上角也有一些工具按钮、

   ![image-20210818182835762](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818182835762.png)

## 原理图

**如果什么都不懂，纯小白，直接从我的原理图中复制就好了，慢慢的就理解了** 

1. 原理图原理图，顾名思义就是表示电路板上各器件之间连接原理的图表。在方案开发等正向研究中，原理图的作用是非常重要的。

2. 原理图是画pcb的前提条件，是我们设计键盘pcb的根本，所以我们要尽量看懂原理图。原理图中所有的符号，起码能认识，符号就代表一个元件，pcb封装就是把实际的电子元器件，芯片等的各种参数（比如元器件的大小，长宽，直插，贴片，焊盘的大小，管脚的长宽，管脚的间距等）用图形方式表现出来，以便可以在画pcb图时进行调用。

   电路板各种电子元器件的一种名字，主要说明元件的引脚的尺寸，间距等的信息，是电子元器件必须的一样技术指标。

   有了符号和封装相互对应，才能从原理图生成pcb。

3. atmega32u4的固定引脚有单独的作用，一般都再符号的左边位置，这些引脚的作用在官方文档中可以查到，比如接多少容值的电容，哪个引脚是reset引脚，D-、D+、GND等等，均在文档中可以查到。这里我提供半吊子单的方法是快速画出pcb，所以建议直接用我的原理图进行复制后使用，包括typec口的接线原理图等等。

### TypeC原理图连线

1. 是两个5.1kΩ的电阻，位号是R1和R2，用于实现CtoC的功能，提高键盘的使用范围，可以直接用ctoc连接Macbook Windows Android iPad 等c口设备使用。CC线上拉Rp或者下拉Rd的电阻主要是用来表面电源传输角色，是source，还是sink。如果看不懂没关系，只需要记住TypeC口的A5和B5引脚，需要用5.1k下拉电阻将电位拉低，也就是电阻另一头接到GND上，就行了。

   ![1ade89667e42df5bdd2f21c2ecdc331](md/半吊子画pcb教程---第三章 原理图的绘制.assets\1ade89667e42df5bdd2f21c2ecdc331-1629710863634.jpg)

   ![e3201046cf2e7d1bc2ace983334938c](md/半吊子画pcb教程---第三章 原理图的绘制.assets\e3201046cf2e7d1bc2ace983334938c-1629710851087.jpg)

   ![img](md/半吊子画pcb教程---第三章 原理图的绘制.assets\ae51f3deb48f8c54432b5c4f2a292df5e1fe7fd2)

2. 是TypeC接口的符号，符号中的数字代表的是TypeC引脚，AB代表的是反正面。所以A7要连接B7，A6要连接B6，来实现正反面都可以使用的目的。

3. TVS二极管，用来防电涌防静电击穿等作用。型号是：PRTR5V0U2AX

4. 是两个22欧的电阻，用于连接主控的D-和D+（主控的文档中要求添加）

5. 这两个是标签，标签在原理图中代表连线，同样名称的标签代表的就是一根连线，这样使原理图看上去更简洁。

6. 标号6是个500mA的保险，用于防止短路避免主控损坏。

![image-20210818185843922](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818185843922.png)

### Atmega32u4 原理图连线和引脚的分配

#### 原理图说明

1. 连接到C口的D-和D+，用来与设备通信。

2. 42号引脚AREF引脚属于特殊引脚，一般不用，所以要在这里打叉标识，否则网络检测的时候会报错

3. 这里的VCC的引脚

4. 这里是6号引脚，要接一个1uf的电容（手册里给出）

5. reset按钮，用于进入dfu

6. 标6号，这个是晶振。晶振的频率和电容容值等都在手册中给出的。

7. GND接地引脚

8. 10k电阻这里也是手册给出的

9. 另外还需要增加一些去耦电容，用于主控去耦，遵循以下几点：

   容值最小的电容，有最高的谐振频率，去耦半径最小，因此放在最靠近芯片的位置。

   容值稍大些的可以距离稍远，最外层放置容值最大的。但所有对该芯片去耦的电容都尽量靠近芯片。

![image-20210818190142667](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818190142667.png)

![image-20210818190915114](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210818190915114.png)

#### 引脚的分配

根据我们上一章的矩阵图和引脚分配的结果对主控的引脚进行分配。

1. 点击标签符号，添加一个标签，并且使用 ”R“ 键将标签符号旋转。

   ![image-20210819161532384](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819161532384.png)

2. 将标签符号名成更改为ROW0，并根据上一张分配的引脚找到主控原理图的`B7`引脚进行连接。每当连接好一个标签后，光标会自动变成ROW1如下图：

   ![image-20210819161915636](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819161915636.png)

3. 像这样分配完所有引脚。并将没有分配到标签的主控引脚，用叉标记。

   ![image-20210819163255565](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819163255565.png)

### 键盘矩阵线路原理图的绘制

键盘矩阵线路属于自己主管能动性最强的部分，这里包含了配列和主控引脚的分配，这里可以随意发挥，属于真正的自己定制部分。

- 上一章我们已经分配好了矩阵和主控引脚，我们接下来开始操作：

  1. 首先添加元件，跟上面一样，点击元件库

  2. 搜索MX，找到mx 1u 查看符号类型是否是我们需要的

  3. 点击放置，一个mx轴符号就放进原理图里了

     ![image-20210819152841080](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819152841080.png)

     ![image-20210819152908272](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819152908272.png)

  4. 我们给这个键改一下编号，双击 “U2” 改成 “K0” 代表key0(程序员的一都是从0开始)

  5. 接下来我们给这个键添加一个防止冲突的二极管，简称 “防冲二极管” ，这里要说一下，默认二极管是加在ROW线路上的，如果加在COL线路的的话，需要在固件的`config.h`里写一条, 用来表明二极管的方向从哪里到哪里.

     ```c
     /*You can specify the direction your diodes point. This can be or .COL2ROWROW2COL*/
     #define DIODE_DIRECTION COL2ROW
     ```

  6. 同样点击元件库，搜索贴片二极管 SOD-123，这个是二极管的封装，添加元件的时候最好带着封装添加，这样我们在生成pcb的时候就不用再次分配封装了，放置元件的时候，注意摆放方向，如果元件是横着的按 “R” 键来更换方向，将二极管的正极也就是三角号的屁股连接到轴体符号的ROW上。如图：

     ![image-20210819155217296](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819155217296.png)

     ![image-20210819160024275](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819160024275.png)

  7. 接下来，我们整个选中轴体符号和二极管符号，然后按 ”ctrl+c“ 进行复制，并且粘贴，按矩阵排布，第一排有16个键，但存在多配列兼容重复按键的情况，连线的时候再考虑，我们粘贴15次。注意间隔和高度最好一致，这样矩阵线路ROW是平直的。

     ![image-20210819160657839](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819160657839.png)

  8. 接下来我们画线路 ”ROW0“，点击 ”w“ ，鼠标光标编程这种就可以画线了，这里因为13和14键值是一样的，为了增加多配列的兼容，理论上14键与13键不能同时存在，所以使用同一个矩阵，二极管也用同一个。

     ![image-20210819164328519](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819164328519.png)

  9. 画好线点击标签，给这条线添加标签ROW0，我这里更改了二极管的位号，与轴体一致

     ![image-20210819171230894](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210819171230894.png)

  10. 这样我们的矩阵第一ROW线路就完成了。我们来画好剩下的键。其中capslock因为要添加指示灯，所以我用了mx轴带led灯的符号。
  
      ![image-20210820120755727](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820120755727.png)
  
  11. 画完原理图后，我们对每个键的键值进行修改，将MX标识改成每个键的键值。这样会更直观。
  
      ![image-20210820155246881](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820155246881.png)

### 检查和分配封装

> 原理图基本已经完成，接下来我们要检查和分配封装了，为生成pcb做准备。从头进行检查。

1. 检查usb口的封装是否是我们想要的。如果是我们想要的，就可以使用默认封装，如果不是我们想要的，就需要更改封装。下图看的出，C口是我们想要的封装。

   ![image-20210820145537689](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820145537689.png)

2. 检查其他元件的封装，是否是我们想要的。比如电阻电容等，一般常用的是0805或者0603等贴片电容，这里推荐在板子空间足够允许的情况下，使用大封装值的封装，这样能方便我们焊接。这里我们修改电阻的封装值。其他元件大同小异。直接搜索封装后点下面的更新即可。也可以批量修改。下面我用MX轴作演示。Atmega32u4的封装有两种，一种mu结尾的属于QFN44 7x7mm封装，无外露引脚，此种封装类型较小，比较节省空间，但是焊接起来比较麻烦，需要风枪。还有一种是AU结尾的，此种封装类型是TQFP44 10x10mm封装。此种封装较大，使用电烙铁就可以完成焊接。

   ![image-20210820150358086](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820150358086.png)

   ![image-20210820161459341](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820161459341.png)

   ![image-20210820161544271](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820161544271.png)

3. 下面我用批量修改MX轴的封装演示一遍批量修改封装。

   1. 我们查看一个MX轴的封装值，并没有默认分配封装，下面我们来批量修改，这里面有一些轴的封装是1u，还有一些是1.5u、2u、2.25、2.75、7u等等。我们没要做好区分。我们点击搜索按钮，然后在下面的搜索到的封装列表中找到我们想要的封装，如果实在找不到，我们也可以自建封装，但一般都是可以找到的，如果不满意，我们可以对找到的差不多的封装进行修改使用。

   ![image-20210820150734356](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820150734356.png)

   ![image-20210820151308566](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820151308566.png)

   ![image-20210820161708108](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820161708108.png)

4. 如果我们实在找不到自己想要的封装，但有差不多的封装，我们可以修改之后自己使用，关闭弹窗，我们依旧点击元件库，搜索 “cherry mx 1u”。然后点击下面的封装，在列表中找自己需要的差不多的封装。找到后选中，点击下面的编辑，然后修改封装到自己想要的样子。我实在没找到自己想要的样子，所以搜索了“kaihua”，找到了自己想要的轴座封装。我们看一下符号的引脚都是什么名称，在我们编辑后封装的时候，焊盘名城也要于符号引脚对应，这样才能将符号对应到轴座封装的焊盘上。我们看到符号的引脚名称是COL和ROW。我们在编辑封装的时候也要确认焊盘的名成。

   ![image-20210820152419581](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820152419581.png)

   ![image-20210820155609778](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820155609778.png)

5. 点击编辑后，为了更好的使用高价购买的GMK键帽和其他JTK，EPBT等原厂高度键帽，我们首先要做的就是把轴体方向正过来，全选封装，按下R键。

   ![image-20210820152726581](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820152726581.png)

6. 然后我们删除不需要的RGB灯座。选中RGB灯座，点击 “Delete” 键。此时轴座封装就是我们想要的封装了。我们检查一下尺寸，是不是我们想要的，默认键盘的尺寸是1U=19.05mm. 可以看到符合我们的需求。接下来我们检查焊盘的名称能否与符号对应，如果可以对应的。删除掉尺寸标记，然后我们点击 “Ctrl + s” 保存这个刚刚修应该好的封装。如果焊盘名成不能与符号引脚对应，就要修改焊盘名称。

   ![image-20210820155920486](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820155920486.png)

   ![image-20210820153739268](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820153739268.png)

   ![image-20210820153933884](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820153933884.png)

7. 下面我们用我们刚刚修改的封装给原理图的符号分配。选中一个符号，点击封装值，再封装的左边全选相同的1u符号，右边搜索到我们刚刚修改的封装类型，选中后可以看到符号图和封装图引脚的对应连线。然后点击更新，就将封装分配完毕了。

   ![image-20210820160350628](md/半吊子画pcb教程---第三章 原理图的绘制.assets\image-20210820160350628.png)

8. 接下来我们对1.5u、2u、2.25u、2.75u等封装进行编辑创建和分配。与上面步骤相同。有卫星轴的注意卫星轴的安装方向。当我们分配完成后，一定要记得保存原理图，时刻记得`ctrl +s`,不然我们修改的进度都丢失了。







